# üõí –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Medusa —Å BiomorphX

## üéØ –ß—Ç–æ –ø–æ–ª—É—á–∏–º —Å Medusa

### ‚úÖ **–ü–æ–ª–Ω—ã–π e-commerce —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏** (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –≤–∞—Ä–∏–∞–Ω—Ç—ã, —Ü–µ–Ω—ã)
- **–ö–æ—Ä–∑–∏–Ω–∞ –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤**
- **–°–∏—Å—Ç–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π** (Stripe, PayPal, –°–±–µ—Ä–±–∞–Ω–∫)
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏** –∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏
- **–°–∏—Å—Ç–µ–º–∞ —Å–∫–∏–¥–æ–∫** –∏ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π** (–°–î–≠–ö, –ü–æ—á—Ç–∞ –†–æ—Å—Å–∏–∏)
- **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂** –∏ –æ—Ç—á–µ—Ç—ã
- **–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å** –∏ –≤–∞–ª—é—Ç—ã

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Medusa Backend

```bash
# –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è Medusa
mkdir medusa-backend
cd medusa-backend

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–µ–∫—Ç
npx create-medusa-app@latest

# –í—ã–±–∏—Ä–∞–µ–º:
# - Backend only
# - PostgreSQL (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
# - Redis (–¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è)
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL
# –î–ª—è Windows: https://www.postgresql.org/download/windows/
# –î–ª—è Linux: sudo apt-get install postgresql

# –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
createdb biomorphx-medusa

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è .env

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgres://username:password@localhost:5432/biomorphx-medusa

# Redis
REDIS_URL=redis://localhost:6379

# JWT —Å–µ–∫—Ä–µ—Ç
JWT_SECRET=your-super-secret-jwt-key

# Cookie —Å–µ–∫—Ä–µ—Ç
COOKIE_SECRET=your-super-secret-cookie-key

# –ü–ª–∞—Ç–µ–∂–∏ (Stripe)
STRIPE_API_KEY=sk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...

# –î–æ—Å—Ç–∞–≤–∫–∞
SHIPPO_API_KEY=shippo_test_...
```

### 4. –ó–∞–ø—É—Å–∫ Medusa Backend

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
npx medusa migrations run

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev

# –ò–ª–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
npm run start
```

### 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Next.js Frontend

```bash
# –í –ø–∞–ø–∫–µ biomorphx —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Medusa SDK
npm install @medusajs/medusa-js
```

### 6. –°–æ–∑–¥–∞–Ω–∏–µ Medusa –∫–ª–∏–µ–Ω—Ç–∞

```javascript
// src/lib/medusa.js
import Medusa from "@medusajs/medusa-js"

const medusaClient = new Medusa({
  baseUrl: process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL || "http://localhost:9000",
  maxRetries: 3
})

export default medusaClient
```

### 7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ProductCard –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Medusa

```javascript
// src/components/ProductCard.js
import { useCart } from "medusa-react"

const ProductCard = ({ product }) => {
  const { addItem } = useCart()
  
  const handleAddToCart = () => {
    addItem({
      variantId: product.variants[0].id,
      quantity: 1
    })
  }
  
  return (
    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
  )
}
```

## üì¶ –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

```javascript
// scripts/migrate-products.js
import medusaClient from "../src/lib/medusa.js"

const existingProducts = [
  // –í–∞—à–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ data/products.js
]

async function migrateProducts() {
  for (const product of existingProducts) {
    try {
      await medusaClient.admin.products.create({
        title: product.name,
        description: product.longDescription,
        handle: product.id,
        status: "published",
        variants: [{
          title: "Default",
          prices: [{
            amount: product.price * 100, // Medusa –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–ø–µ–π–∫–∏
            currency_code: "rub"
          }],
          inventory_quantity: 100,
          manage_inventory: true
        }],
        images: [{
          url: product.image
        }],
        options: [{
          title: "–†–∞–∑–º–µ—Ä",
          values: ["300 –º–≥", "400 –º–≥"]
        }]
      })
      console.log(`‚úÖ –¢–æ–≤–∞—Ä ${product.name} —Å–æ–∑–¥–∞–Ω`)
    } catch (error) {
      console.error(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è ${product.name}:`, error)
    }
  }
}

migrateProducts()
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π

### 1. Stripe (–æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Stripe –ø–ª–∞–≥–∏–Ω–∞
npm install medusa-payment-stripe

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ medusa-config.js
const plugins = [
  {
    resolve: "medusa-payment-stripe",
    options: {
      api_key: process.env.STRIPE_API_KEY,
      webhook_secret: process.env.STRIPE_WEBHOOK_SECRET,
    },
  },
]
```

### 2. –†–æ—Å—Å–∏–π—Å–∫–∏–µ –ø–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã

```bash
# –°–±–µ—Ä–±–∞–Ω–∫
npm install medusa-payment-sberbank

# –ÆMoney
npm install medusa-payment-yoomoney
```

## üöö –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏

### 1. –°–î–≠–ö

```bash
npm install medusa-shipping-cdek
```

### 2. –ü–æ—á—Ç–∞ –†–æ—Å—Å–∏–∏

```bash
npm install medusa-shipping-russian-post
```

## üìä –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Medusa Admin

```bash
npx create-medusa-app@latest --admin-only
```

### 2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞–¥–º–∏–Ω–∫–∏

```javascript
// src/app/admin/medusa/page.js
import { MedusaProvider } from "medusa-react"
import medusaClient from "../../../lib/medusa"

export default function AdminPage() {
  return (
    <MedusaProvider
      baseUrl={process.env.NEXT_PUBLIC_MEDUSA_BACKEND_URL}
      queryClientProviderProps={{ client: queryClient }}
    >
      {/* –í–∞—à–∞ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å */}
    </MedusaProvider>
  )
}
```

## üöÄ –î–µ–ø–ª–æ–π –Ω–∞ Beget

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
biomorphx/
‚îú‚îÄ‚îÄ frontend/          # Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ backend/           # Medusa backend
‚îú‚îÄ‚îÄ admin/             # Medusa admin (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îî‚îÄ‚îÄ docker-compose.yml # –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
```

### 2. Docker Compose –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```yaml
# docker-compose.yml
version: "3.8"
services:
  postgres:
    image: postgres:13
    environment:
      POSTGRES_DB: biomorphx-medusa
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:6-alpine
    ports:
      - "6379:6379"

  medusa:
    build: ./backend
    ports:
      - "9000:9000"
    environment:
      DATABASE_URL: postgres://postgres:postgres@postgres:5432/biomorphx-medusa
      REDIS_URL: redis://redis:6379
    depends_on:
      - postgres
      - redis

volumes:
  postgres_data:
```

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Ä–µ—Å—É—Ä—Å—ã

### **Medusa Backend:**
- **CPU**: 1-2 —è–¥—Ä–∞
- **RAM**: 2-4 GB
- **Storage**: 20-50 GB
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL
- **–ö—ç—à**: Redis

### **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:**
- **Stripe**: 2.9% + 30 –∫–æ–ø–µ–µ–∫ –∑–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
- **–°–î–≠–ö**: –æ—Ç 200 —Ä—É–±–ª–µ–π –∑–∞ –¥–æ—Å—Ç–∞–≤–∫—É
- **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç**: –±–µ—Å–ø–ª–∞—Ç–Ω–æ (Let's Encrypt)

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Medusa

### ‚úÖ **–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å:**
- –í–µ—Å—å –∫–æ–¥ —É –≤–∞—Å
- –ù–µ—Ç –µ–∂–µ–º–µ—Å—è—á–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –ª—é–±–æ–π —á–∞—Å—Ç–∏

### ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:**
- API-first –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
- –û–±–ª–∞—á–Ω–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å

### ‚úÖ **–†–æ—Å—Å–∏–π—Å–∫–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–æ—Å—Å–∏–π—Å–∫–∏–º–∏ —Å–ª—É–∂–±–∞–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
- –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Medusa Backend**
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö**
3. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å Next.js**
4. **–ú–∏–≥—Ä–∏—Ä—É–π—Ç–µ —Ç–æ–≤–∞—Ä—ã**
5. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–ª–∞—Ç–µ–∂–∏ –∏ –¥–æ—Å—Ç–∞–≤–∫—É**
6. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø–æ–∫—É–ø–∫–∏**

–•–æ—Ç–∏—Ç–µ –Ω–∞—á–∞—Ç—å —Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Medusa Backend?

