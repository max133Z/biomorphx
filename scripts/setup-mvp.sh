#!/bin/bash

# üöÄ –°–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ MVP BiomorphX —Å SQLite
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: bash setup-mvp.sh

echo "üöÄ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MVP BiomorphX —Å SQLite..."

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
print_status() {
    echo -e "${GREEN}‚úÖ $1${NC}"
}

print_warning() {
    echo -e "${YELLOW}‚ö†Ô∏è  $1${NC}"
}

print_error() {
    echo -e "${RED}‚ùå $1${NC}"
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω –æ—Ç root –∏–ª–∏ —Å sudo
if [ "$EUID" -ne 0 ]; then
    print_error "–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω —Å –ø—Ä–∞–≤–∞–º–∏ sudo"
    exit 1
fi

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
print_status "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã..."
apt update && apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js 18
print_status "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js 18..."
curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
apt install -y nodejs

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ Node.js
NODE_VERSION=$(node --version)
print_status "Node.js —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: $NODE_VERSION"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx
print_status "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx..."
apt install -y nginx certbot python3-certbot-nginx

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2
print_status "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2..."
npm install -g pm2

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
print_status "–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è biomorphx..."
useradd -m -s /bin/bash biomorphx
usermod -aG sudo biomorphx

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
print_status "–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π..."
mkdir -p /home/biomorphx/medusa-backend
mkdir -p /home/biomorphx/biomorphx-frontend
mkdir -p /home/biomorphx/backups

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤
chown -R biomorphx:biomorphx /home/biomorphx

print_status "–ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è biomorphx:"
echo "   su - biomorphx"
echo ""
echo "2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Medusa Backend:"
echo "   cd /home/biomorphx/medusa-backend"
echo "   npx create-medusa-app@latest"
echo "   # –í—ã–±–µ—Ä–∏—Ç–µ: Backend only, SQLite"
echo ""
echo "3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ .env —Ñ–∞–π–ª:"
echo "   nano .env"
echo "   # –î–æ–±–∞–≤—å—Ç–µ:"
echo "   DATABASE_URL=file:./data.db"
echo "   JWT_SECRET=your-secret-key"
echo "   COOKIE_SECRET=your-cookie-secret"
echo "   NODE_ENV=production"
echo ""
echo "4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Medusa:"
echo "   npm install"
echo "   npx medusa migrations run"
echo "   pm2 start npm --name 'medusa-backend' -- start"
echo ""
echo "5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx (–∫–∞–∫ root):"
echo "   nano /etc/nginx/sites-available/biomorphx-backend"
echo ""
echo "6. –ü–æ–ª—É—á–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:"
echo "   certbot --nginx -d api.yourdomain.com"
echo ""
print_status "–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"

